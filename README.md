
# üöÄ Safe Python Script Execution Service

This project provides an API service designed to securely execute arbitrary Python scripts in a sandboxed environment. The service only executes scripts containing a `main()` function and returns the function's JSON output, enforcing security and sandbox restrictions.

## ‚ú® Features

- **Script Execution**: Allows users to submit Python scripts with a `main()` function and returns the function's result.
- **Input Validation**: Validates that the submitted script includes a `main()` function that returns JSON.
- **Security**: Uses `nsjail` to sandbox the environment and restrict unauthorized operations.
- **Standard Libraries**: Provides access to basic libraries like `os`, `pandas`, and `numpy`.
- **Dockerized**: Runs in a lightweight Docker container for easy deployment.

## üìã Requirements

- **Docker**: Ensure Docker is installed to build and run the container.
- **Python 3.9+**: Developed and tested with Python 3.9.

## ‚öôÔ∏è Installation and Setup

1. **Clone the repository**:
   ```bash
   git clone https://github.com/code-griffin/safe-python-script-execution.git
   cd safe-python-script-execution
   ```

2. **Build the Docker image**:
   ```bash
   docker build -t safe-script-executor .
   ```

3. **Run the Docker container**:
   ```bash
   docker run -p 8080:8080 safe-script-executor
   ```

## üßë‚Äçüíª Usage

To execute a Python script, send a POST request to the `/execute` endpoint.

### Example cURL Request

```bash
curl -X POST http://localhost:8080/execute      -H "Content-Type: application/json"      -d '{"script": "def main(): return {\"result\": \"Hello, World!\"}"}'
```

### Expected Response Format

The API will return a JSON response containing the output of the `main()` function and any standard output generated by the script:

```json
{
  "result": { "result": "Hello, World!" },
  "stdout": ""
}
```

#### Error Examples

- **Script missing `main()` function**:
  ```json
  {
    "error": "Script must contain a main() function"
  }
  ```

- **Non-JSON output from `main()`**:
  ```json
  {
    "error": "Execution did not return valid JSON"
  }
  ```

## ‚òÅÔ∏è Deploying on Google Cloud Run

To deploy on Google Cloud Run, ensure you have a Google Cloud project with billing enabled and required APIs.

1. **Build and Push the Docker Image**:
   ```bash
   gcloud builds submit --tag gcr.io/YOUR_PROJECT_ID/safe-script-executor
   ```

2. **Deploy to Cloud Run**:
   ```bash
   gcloud run deploy safe-script-executor        --image gcr.io/YOUR_PROJECT_ID/safe-script-executor        --platform managed        --allow-unauthenticated
   ```

Once deployed, you can access the service via the provided Cloud Run URL.

## üß™ Testing the Service Manually

You can manually test the `/execute` endpoint using `curl` requests:

### Test with Valid Script

```bash
curl -X POST http://localhost:8080/execute      -H "Content-Type: application/json"      -d '{"script": "def main(): return {\"result\": \"Hello, World!\"}"}'
```

### Test with Script Missing `main()` Function

```bash
curl -X POST http://localhost:8080/execute      -H "Content-Type: application/json"      -d '{"script": "print(\"Hello, World!\")"}'
```

Expected response:

```json
{
  "error": "Script must contain a main() function"
}
```

### Test with Invalid JSON Return

```bash
curl -X POST http://localhost:8080/execute      -H "Content-Type: application/json"      -d '{"script": "def main(): return \"This is not JSON\""}'
```

Expected response:

```json
{
  "error": "Execution did not return valid JSON"
}
```

## üõ†Ô∏è Implementation Details

- **Flask Framework**: Provides the REST API.
- **nsjail**: Sandboxes the execution environment for secure script execution.
- **Docker**: Packages the application for easy deployment and isolation.

## ‚ö†Ô∏è Notes

- **Security**: `nsjail` enforces restrictions on the script's environment, but always review scripts before execution in sensitive environments.
- **Error Handling**: The service returns specific error messages for scripts missing `main()` or those that do not output valid JSON.
